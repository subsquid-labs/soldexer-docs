---
title: "Build an Indexer from Scratch"
description: "Learn to compose SDK packages into a complete indexer"
---

# Build an Indexer from Scratch

This guide demonstrates how SDK packages can be combined into a working indexer (called a _squid_).

This page goes through all the technical details to make the squid architecture easier to understand. If you want to get to a working indexer ASAP, [bootstrap from a template](/en/sdk/squid-sdk/evm/getting-started/squid-development#templates).

## Prerequisites

Before you begin, ensure you have:

- **Node.js 20.x or newer** - [Download here](https://nodejs.org/)
- **Docker** - [Download here](https://www.docker.com/)

## Project: USDT Transfers API

In this tutorial, you'll build an indexer that tracks USDT transfers on Ethereum, saves the data to PostgreSQL, and serves it as a GraphQL API.

### Required packages

From the requirements above, you'll need these [packages](/en/sdk/squid-sdk/evm/getting-started/overview):

- `@subsquid/evm-processor` - for retrieving Ethereum data
- `@subsquid/typeorm-store`, `@subsquid/typeorm-codegen`, and `@subsquid/typeorm-migration` - for saving data to PostgreSQL

### Optional packages

- `@subsquid/evm-typegen` - for decoding Ethereum data and useful constants such as event topic0 values
- `@subsquid/evm-abi` - as a peer dependency for the code generated by `@subsquid/evm-typegen`
- `@subsquid/graphql-server` / [OpenReader](/en/sdk/squid-sdk/reference/openreader-server/overview) - for serving GraphQL API

## Build the Indexer

<Steps>

<Step title="Initialize the project">

Create a new folder and initialize a Node.js project:

```bash
npm init
```

Create a `.gitignore` file:

```.gitignore .gitignore
node_modules
lib
```

</Step>

<Step title="Install dependencies">

Install the required packages with Portal API support:

```bash
npm i dotenv typeorm @subsquid/evm-processor@portal-api @subsquid/typeorm-store @subsquid/typeorm-migration @subsquid/graphql-server @subsquid/evm-abi
```

<Note>
  The `@portal-api` version of `@subsquid/evm-processor` is required for Portal support.
</Note>

Install development dependencies:

```bash
npm i typescript @subsquid/typeorm-codegen @subsquid/evm-typegen --save-dev
```

</Step>

<Step title="Configure TypeScript">

Create a `tsconfig.json` file with minimal configuration:

```json tsconfig.json
{
  "compilerOptions": {
    "rootDir": "src",
    "outDir": "lib",
    "module": "commonjs",
    "target": "es2020",
    "esModuleInterop": true,
    "skipLibCheck": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  }
}
```

</Step>

<Step title="Define the data schema">

Create a `schema.graphql` file to define your data model:

```graphql schema.graphql
type Transfer @entity {
  id: ID!
  from: String! @index
  to: String! @index
  value: BigInt!
}
```

Generate TypeORM classes from the schema:

```bash
npx squid-typeorm-codegen
```

<Check>The TypeORM classes are now available at `src/model/index.ts`.</Check>

</Step>

<Step title="Set up the database">

Create environment variables in a `.env` file:

```.env .env
DB_NAME=squid
DB_PORT=23798
RPC_ETH_HTTP=https://rpc.ankr.com/eth
```

Create a `docker-compose.yaml` file for PostgreSQL:

```yaml docker-compose.yaml
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: "${DB_NAME}"
      POSTGRES_PASSWORD: postgres
    ports:
      - "${DB_PORT}:5432"
```

Start the database:

```bash
docker compose up -d
```

Compile the TypeORM classes:

```bash
npx tsc
```

Generate and apply the database migration:

```bash
npx squid-typeorm-migration generate
npx squid-typeorm-migration apply
```

</Step>

<Step title="Generate ABI utilities">

Create an `abi` folder for contract ABIs:

```bash
mkdir abi
```

Find the [USDT contract ABI on Etherscan](https://etherscan.io/address/0xdAC17F958D2ee523a2206206994597C13D831ec7#code) and save it to `./abi/usdt.json`.

Generate TypeScript utility classes from the ABI:

```bash
npx squid-evm-typegen src/abi ./abi/*
```

<Check>The utility classes are now available at `src/abi/usdt.ts`.</Check>

</Step>

<Step title="Create the processor">

Create `src/main.ts` with the following code blocks:

### Imports

```typescript main.ts
import { EvmBatchProcessor } from "@subsquid/evm-processor";
import { TypeormDatabase } from "@subsquid/typeorm-store";
import * as usdtAbi from "./abi/usdt";
import { Transfer } from "./model";
```

### Processor configuration

```typescript main.ts
const processor = new EvmBatchProcessor()
  .setPortal("https://portal.sqd.dev/datasets/ethereum-mainnet")
  .setRpcEndpoint({
    url: process.env.RPC_ETH_HTTP,
    rateLimit: 10,
  })
  .setFinalityConfirmation(75) // 15 mins to finality
  .addLog({
    address: ["0xdAC17F958D2ee523a2206206994597C13D831ec7"],
    topic0: [usdtAbi.events.Transfer.topic],
  });
```

### Database configuration

```typescript main.ts
const db = new TypeormDatabase();
```

### Batch handler

```typescript main.ts
processor.run(db, async (ctx) => {
  const transfers: Transfer[] = [];
  for (let block of ctx.blocks) {
    for (let log of block.logs) {
      let { from, to, value } = usdtAbi.events.Transfer.decode(log);
      transfers.push(
        new Transfer({
          id: log.id,
          from,
          to,
          value,
        })
      );
    }
  }
  await ctx.store.insert(transfers);
});
```

<Tip>
  Supplying a `TypeormDatabase` to the function causes `ctx.store` to be a
  [PostgreSQL-compatible `Store`
  object](/en/sdk/squid-sdk/reference/store/typeorm#store-interface).
</Tip>

</Step>

<Step title="Run the processor">

Compile the project:

```bash
npx tsc
```

Start the processor:

```bash
node -r dotenv/config lib/main.js
```

<Check>
  The processor is now indexing USDT transfers from the Ethereum blockchain.
</Check>

</Step>

<Step title="Start the GraphQL server">

Update your `.env` file to include the GraphQL server port:

```.env .env
DB_NAME=squid
DB_PORT=23798
RPC_ETH_HTTP=https://rpc.ankr.com/eth
GRAPHQL_SERVER_PORT=4350
```

In a separate terminal, start the GraphQL server:

```bash
npx squid-graphql-server
```

<Check>
  The GraphQL API with GraphiQL is available at
  [localhost:4350/graphql](http://localhost:4350/graphql).
</Check>

</Step>

</Steps>

## Next Steps

Congratulations! You've built a complete blockchain indexer from scratch.

<CardGroup cols={2}>
  <Card
    title="View Complete Code"
    icon="github"
    href="https://github.com/subsquid-labs/squid-from-scratch"
  >
    See the final code for this tutorial
  </Card>

  <Card
    title="Development Flow"
    icon="diagram-project"
    href="/en/sdk/squid-sdk/evm/getting-started/squid-development"
  >
    Learn about the general development workflow
  </Card>
</CardGroup>

<Tip>
  The commands in this tutorial are often abbreviated as [custom `sqd`
  commands](/en/sdk/squid-sdk/tools/cli) in production squids. Use the
  [`commands.json` file from the EVM
  template](https://github.com/subsquid-labs/squid-evm-template/blob/main/commands.json)
  as a starter.
</Tip>
